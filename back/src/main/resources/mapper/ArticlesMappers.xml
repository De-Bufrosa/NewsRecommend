<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smacul.demo.dao.ArticlesDao">
    <select id="searchArtTypes" resultType="String">
        select art_type from Articles group by art_type order by count(art_type) desc
    </select>

    <select id="searchTinyArtOnePageByType" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleScoreList on Articles.art_id = ArticleScoreList.asl_article_id
        where art_type = #{artType}
        order by art_time desc
        limit #{start}, #{pageSize}
    </select>

    <select id="searchTinyArtOnePageFromGlobal" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleScoreList on Articles.art_id = ArticleScoreList.asl_article_id
        order by asl_article_score desc
        limit #{start}, #{pageSize}
    </select>

    <select id="searchHotArtOnePage" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleTimeList on Articles.art_id = ArticleTimeList.atl_article_id
        order by atl_article_score desc
        limit #{start}, #{pageSize}
    </select>

    <select id="searchFullArtWithCus" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select A.*,
            C.cus_avatar_url as 'customer.cusAvatarUrl',
            C.cus_id as 'customer.cusId',
            C.cus_name as 'customer.cusName',
            C.cus_type as 'customer.cusType'
        from Articles as A, Customers as C
        where A.art_id = #{artId} and A.art_customer_id = C.cus_id
    </select>

    <select id="searchContentByKeyAndTagTypePage" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleScoreList on Articles.art_id = ArticleScoreList.asl_article_id
        where art_title like #{key} or art_content like #{key} or cus_name like #{key}
        order by art_time desc
        limit #{start}, #{pageSize}
    </select>

    <select id="searchContentAuthor" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleScoreList on Articles.art_id = ArticleScoreList.asl_article_id
        where cus_name like #{key}
        order by art_time desc
        limit #{start}, #{pageSize}
    </select>

    <select id="searchContentArticle" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleScoreList on Articles.art_id = ArticleScoreList.asl_article_id
        where art_title like #{key} or art_content like #{key}
        order by art_time desc
        limit #{start}, #{pageSize}
    </select>

    <select id="searchContentGlobal" resultType="com.smacul.demo.model.ArticleCustomerModel">
        select art_id, art_title, art_time, art_image_url, art_customer_id,
                cus_id as 'customer.cusId',
                cus_name as 'customer.cusName'
        from (Articles left join Customers on Articles.art_customer_id = Customers.cus_id)
                left join ArticleScoreList on Articles.art_id = ArticleScoreList.asl_article_id
        where art_title like #{key} or art_content like #{key} or cus_name like #{key}
        order by art_time desc
        limit #{start}, #{pageSize}
    </select>


    <update id="updateArtLikeNum">
        update Articles set art_like_num=art_like_num+1 where art_id=#{artId}
    </update>

    <update id="updateArtDislikeNum">
        update Articles set art_dislike_num=art_dislike_num+1 where art_id=#{artId}
    </update>

</mapper>